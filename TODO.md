## TODO

This document is essentially a list of shorthand notes describing work yet to completed.
Unfortunately it is not complete enough for other people to pick work off the list and
complete as there is too much un-said.

### Next Release

* Add ability to `@Prop` to add enhancers to builder. Convert several existing special cased methods in builder
  (See TODOs in Generator.java) with the enhancers.

* Add to build process so that every published packaged is attempted to be built using bazel to
  ensure it's dependencies align.

* Generate a suppressable warning if any lifecycle method is public

* Generate a suppressable warning if any lifecycle method is protected and in class
  annotated with `@ReactComponent`

* The `MUST NOT BE PUBLIC` rules in annotation processor should be turned into warnings, made suppress-able
  and propagated to Arez for their lifecycle hooks.

* Generate a compile warning if public methods are declared in a react class or any parent class (unless they
  are implementations of an interface). This warnings should be able to be suppressed.

* Generate a compile warning if protected methods are declared in a react class. This warnings should be able
  to be suppressed.

* Consider defaulting requireId=ENABLE in Arez to avoid errors with immutable props. Make sure immutable props
  favour Keyed over ArezId if type implements/extends `Keyed` and is annotated by `@ActAsComponent` 

### Enhancements

* Generate documentation for components from annotations. This documentation could use the prop types to give
  basic documentation overview and then use special annotations to give extended documentation and/or reference
  examples that will be both output as documentation and fed into basic test infrastructure. This ensures that the
  examples will continue to work as the library is evolved. There is a few examples like this in react world ...
  stylguidist??

* The message that indicates prop does not match immutable constraints should say exactly why. (i.e. Is not
  primitive, Arez component nor implements Keyed or if an ArezComponent indicate it needs a requireId=ENABLE etc)

* Javascript Asset Loader: As the code generated by the annotation processor references native javascript classes
  defined in `react.js`, the javascript **MUST** be loaded prior to the GWT code defines the classes which is before
  the `EntryPoint.onModuleLoad()` is invoked. An attempt was made to load the assets via non embedded `DataResource`
  in https://github.com/react4j/react4j/pull/25 but failed for the above reasons. The only solution seems to be to
  write a custom linker that either generates the host html, has a multi-stage javascript linker (that only continues
  loading gwt code after a chain of native js is also loaded). However this is digging deeper into GWT2.x ecosystem
  when maybe the effort is better spent transitioning to J2CL. Either way we should have a mehcanism via which we
  use content hashing for javascript and load it as part of app startup to avoid downstream applications having to
  worry about caching and changes in react.js versions.

* Implement react-cache and update react4j-drumloop
  It should be noted that when the `react-cache` instances throws a `Promise` it must be the same
  instance for the same entry. Suspense uses the promise as a key into maps to dedupe listeners etc.

* Add additional `@ReacComponent.type` value `STATELESS` that would result in render being inlined into caller
  without a component in production mode. Component must have no fields, arez elements and no lifecycle methods.
  The `shouldComponentUpdate()` is skipped for this scenario.

* Reactor the way the `dom` library creates host `ReactElement` instances to avoid copying props and adding
  special handling for `ref`, `key` and `children` and instead creating elements directly.

* Figure out a way to get the *Builders eliminated. May need a closure-compiler pass.

* Figure out a way to define dom factories in java that are optimized away in production such that
  `DOM.h1().className('foo').tabIndex(3).children("Hello",DOM.span().className('red').children('World'))`
  compiles to `React.createElement('h1', {className: 'foo', tabIndex:3},["Hello",React.createElement('span',{className: 'red'},['World'])])`
  Maybe judicious use of `@ForceInline`? `.children` or `.build` closing the element. Perhaps these
  element factories can be built by looking at html spec and auto-generating? The props classes should also be
  converted into `JsPropertyMap<Object>` instances so that the externs for react.js need not include all the props
  that can not be minimized under J2CL.
  - https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts
  - https://www.w3schools.com/tags/ref_standardattributes.asp
  - Consider typed refs that bind to underlying Elemental2 element.

* Migrate to React 16.5.0 features
  - https://github.com/facebook/react/blob/master/CHANGELOG.md#1650-september-5-2018
  - Consider generating "Interaction tracking with React" - https://gist.github.com/bvaughn/8de925562903afd2e7a12554adcdda16
  - Consider adding `react-dom/profiling` "production" javascript profiler - may need to wait for umd variant of
    production js produced. - https://github.com/facebook/react/issues/13634

- EventHandlers in Arez based components should somehow detect Arez.isSchedulerPaused() and persist any event and
  schedule onceoff action that will be re-run when scheduler is enabled. It is whether it would be possible to do
  this lower down in the react stack.
- EventHandlers should probably start profiler "interactions" by default with the ability to disable

* Animation/Transition capabilities are getting more urgent.
  - https://react-simple-animate.now.sh/ (Seems like the best easy option)
  - https://www.npmjs.com/package/@nearform/react-animation
  - https://github.com/reactjs/react-transition-group/blob/master/src/Transition.js
  - https://popmotion.io/pose/
  - Source transition components from VueJS. See https://www.udemy.com/vuejs-2-the-complete-guide for good example

* In base class have configuration that warns on re-renders that produced duplicate values.

* build in https://github.com/maicki/why-did-you-update

* Add some way to define effects which is just method called after render that returns a disposable to stop action.
  Possibly look at Observe props and if they change then dispose and re-run? i.e. could be wrapped in `@Observe`
  method that calls dispose on previous return if any. (From react 17)

* Consider making the methods annotated with `@PostRender`, `@PostUpdate` and `@PostMount` take a parameter that
  will push the call into a task that is invoked at a later time. Roughly we want to be able to take an effect and
  push it outside the commit phase of react rendering and have it run later

* Collections returned from props should be made immutable.

* Consider replacing the "backend" of the component model with hooks. The advantages are:
  - The DevTools could be updated to present Arez debug data in nested block.

* Integrate [React.warn](https://github.com/facebook/react/pull/15170) when it ships.

* Consider a Css toolkit that reads a config like in [Tailwind CSS](https://tailwindcss.com/docs/what-is-tailwind/)
  and generates a java factory class. This would use the developer affordances of Tailwind and either generate
  inline css or css class names where unused classes can be stripped. THis may require a compiler pass in Closure
  to work.

#### Documentation

* Add graph reflecting size of TodoMVC over time

* Reorganize documentation using the following sites as inspiration.
  - Reason React - https://reasonml.github.io/reason-react/
  - VueGWT - https://axellience.github.io/vue-gwt/introduction/
  - https://fblitho.com/

* Incorporate many of the ideas of Litho. Inadvertently we seem to have created something that looks similar with
  slight differences. Probably because both libraries try to use idiomatic java patterns with a react-like engine.

* Add lifecycle image from https://twitter.com/dan_abramov/status/981712092611989509 and credit author

* Or most excellent image from https://medium.freecodecamp.org/why-react16-is-a-blessing-to-react-developers-31433bfc210a

* Create a jsbin-alike to display GWT code
  - https://github.com/jsbin/jsbin
  - http://jsbin.com/?html,css,js,console,output

* Prepare a screencast for React4j+Arez.
  - Probably use ScreenFLow software https://www.telestream.net/screenflow/
  - Possibly with custom scripting - see https://wickstrom.tech/programming/2018/10/26/writing-a-screencast-video-editor-in-haskell.html
  - See egghead training videos as well.
  - https://www.youtube.com/playlist?list=PLV5CVI1eNcJhc9Lxu83Zp4uyqP2yKV4xl&app=desktop

#### Sample Applications

Applications to build and help asses react4j going forward.

* Port https://github.com/realityforge/Piano-Trainer across to react4j

* https://github.com/Swizec/react-fractals

* https://github.com/rwieruch/favesound-mobx

* Consider a Metronome - https://daveceddia.com/react-practice-projects/#metronome & https://github.com/cwilso/metronome

* realworld-example - https://github.com/gothinkster/react-mobx-realworld-example-app

* WhatsApp clone - https://medium.com/the-guild/whatsapp-clone-using-react-hooks-suspense-graphql-apollo-typescript-and-postgresql-de1840c27d21

* Port Minesweeper
  - https://medium.com/@tdelev/minesweeper-in-typescript-and-react-f5f8a5d57383
  - https://github.com/tdelev/minesweeper-react
  - https://delev.me/minesweeper-react/
  - https://github.com/hinsxd/react-minesweeper

* https://github.com/hinsxd/react-snake

* Tetris clone
  - https://github.com/hinsxd/react-tetris
  - https://tetris.wiki/SRS

* Port https://github.com/benawad/slack-clone-client/tree/53_code_splitting across to react4j. Good way to experiment with GraphQL and few other interesting elements.

* Another app to build is a YouTube clone ala https://github.com/productioncoder/youtube-react
  It seems relatively advanced and may require a router to be in place prior to starting.
  - Blog Series starts here - https://productioncoder.com/build-youtube-in-react-part-1/ thru to https://productioncoder.com/build-youtube-in-react-part-11/
  - Final demo https://www.youtube.com/watch?v=E7wJTI-1dvQ

* [Maze Game](https://github.com/TheCodeDepository/PickleRick-MazeGame)

#### Bazel Integration

* Add Bazel integration rules. Will also need some mechanism for keeping the build artifacts inline. Maybe should
  have a tool that generates a snippet from build.yaml that can be included in WORKSPACE which would mean it always aligns.

* Pull techniques for Bazel/Closure integration and probably externs from https://github.com/tadeegan/react-closure-sample

### Spritz Integration

Could we integrate with React4j such that event handlers are a stream. Props could also be passed
to components as streams and then the component would subscribe and expose the values from stream to user code (ala angular).
This could be done by either generating a wrapper component or preferably by updating code generator.
Vue integration that uses a similar thing inside template language is described in [course](https://egghead.io/courses/build-async-vue-js-apps-with-rxjs)
[Yolk](https://github.com/garbles/yolk) is an interesting framework that died but tackled these approaches in a react-like way.

Another integration approach is to add a "<Stream/>" component that takes a stream as a prop and has a render prop
that has output of stream as parameter. See [react-streams](https://github.com/johnlindquist/react-streams/) for inspiration.

### Fiber Reimplementation

It seems that at some point there may be a demand to re-implement the underlying react reconciliation layer. If
we ever do this here is a list of helpful links that could provide useful

* [react-fiber-implement](https://github.com/tranbathanhtung/react-fiber-implement) A simplified implementation some one is using to learn how fiber works
* [Implementation notes on react's scheduling model](https://gist.github.com/Jessidhia/49d0915b7e722dc5b49ab9779b5906e8)
* Add notes regarding fiber like - https://github.com/acdlite/react-fiber-architecture
* Also useful to extract notes from https://www.youtube.com/watch?v=ZCuYPiUIONs&app=desktop

* Consider a web-worker based implementation that ships commands to main GUI thread. Would need to rpc from main
  thread to work to perform some of the other commands (i.e. myelement.focus()) although maybe refs could be magic-ed
  up such that they use [worker-dom](https://github.com/ampproject/worker-dom)

#### Additional Capabilities

* If we were to ever re-implement the component model at a basic level, an interesting approach would be to
  allow individual components to register actions to occur at each lifecycle stage. We could also use the
  strategies in [ivi](https://github.com/localvoid/ivi) or whatever is winning the
  [uibench](https://localvoid.github.io/uibench/) benchmark at the time. [Nerv](https://github.com/NervJS/nerv)
  has some interesting benchmarks at https://github.com/NervJS/nerv/tree/master/benchmarks but most interesting
  of all is [Preact X](https://github.com/developit/preact/releases/tag/10.0.0-alpha.0).

* Consider using the React4j component model (a.k.a. annotations) and seeing if it can be used to generate
  a custom-element based component such as via Stencil.js. Ideals could also be incorporated from
  [lit-html](https://lit-html.polymer-project.org/) and/or [lit-element](https://lit-element.polymer-project.org/).

* Investigate feasibility of https://github.com/sokra/rawact which compiles react components into native
  browser interactions in attempt to eliminate overhead of library. A similar framework is imba @ http://imba.io/
  which can learn about in https://scrimba.com/p/c6B9rAM - actually imba + Embers AOT template compiler seem
  like a very very very interesting approach.

* Consider the feasibility of converting the current class-based lifecycle hooks into effects added to the fiber.
  This means that you are directly poking at the internals of react but it would mean that we would not have to use
  un-minifiable externs interface to components. Essentially this would involve creating effect objects directly
  and adding them to the queue. See last example in https://medium.com/the-guild/under-the-hood-of-reacts-hooks-system-eb59638c9dba
